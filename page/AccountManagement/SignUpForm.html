<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Login & Registration Form</title>
        <link rel="stylesheet" href="../styling/Stylesheet.css">
</head>
<body>


    <div class="login-page">
        <div class="form">
            <form action="swipe.html" class="register-form" method="POST">
                <input class="input-box" id="username" type="text" placeholder="Username"/>
                <input class="input-box" id="email" type="email" placeholder="Email">
                <input class="input-box" id="password" type="password" placeholder="Password"/>
                <input class="input-box" id="password_conf" type="password" placeholder="Confirm Password"/>
                <button type="button" class="signup-btn" onclick="register()">Sign Up</button>
            </form>

        </div>
    </div>

    <script type="application/javascript">
        function register (){
            const username = document.getElementById("username").value;
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;
            const password_conf = document.getElementById("password_conf").value;

            if(password!==password_conf) {
                alert("Passwords do not match")
                return;
            }
            fetch('http://localhost:8181/api/v1.0/User/register', {
                method: 'post',
                headers: {'Content-Type': 'application/json', 'Accept' : '*/*'
                },
                body: JSON.stringify({
                    "name":username,
                    "email":email,
                    "password":password
                })
            })
                .then(function (response) {
                    if(response.status !== 200) throw response.status;

                    return response.json();

                })
                .then(result => {
                    console.log('Success:', result);
                    if (typeof(Storage) !== "undefined" && result.userID!=null) {
                        localStorage.setItem("userID", result.userID);
                        localStorage.setItem("userName", result.name);
                        window.location.href="../UserDashboard/Dashboard.html";
                    }
                })
                .catch(function (error) {
                    alert(error);
                });

        }

    </script>

</body>
</html>
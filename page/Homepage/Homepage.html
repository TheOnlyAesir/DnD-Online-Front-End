<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Character Forge</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
            integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
            crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
            integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV"
            crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="../../css/homepage_stylesheet.css">


</head>
<body>

<div id="HeaderBox" class="row">

    <div class="Logo col-2 d-flex align-items-center">
        <img style="width: 100%" src="../../Images/Logo_Small.png" class="img-fluid.">
    </div>

</div>


<div class="header" id="OptionsHeader">
    <div class="d-flex">

        <h1 class="StickyHeaderName ">WELCOME!</h1>

        <div class="d-inline-flex StickyHeaderButton">

            <div class="btn-toolbar" role="toolbar" aria-label="Toolbar with button groups">
                <div class="btn-group mr-2" role="group" aria-label="First group">
                    <div class="align-content-center">
                        <button type="button" class="btn btn-danger m-1" data-toggle="modal" data-target="#regModal">
                            Register
                        </button>
                    </div>
                    <div class="modal fade" id="regModal" tabindex="-1" aria-labelledby="regModalLabel"
                         aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="regModalLabel">Registration</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <input id="username" class="form-control mt-2" type="text" placeholder="Username">
                                    <input id="email" class="form-control mt-2" type="email" placeholder="Email">
                                    <input id="password" class="form-control mt-2" type="password"
                                           placeholder="Password">
                                    <input id="password_conf" class="form-control mt-2" type="password"
                                           placeholder="Confirm Password">
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-primary" onclick="register()">Register</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="btn-group mr-2" role="group" aria-label="Second group">
                    <div>
                        <button type="button" class="btn btn-success m-1" data-toggle="modal" data-target="#logModal">
                            Login
                        </button>
                    </div>
                    <div class="modal fade" id="logModal" tabindex="-1" aria-labelledby="logModalLabel"
                         aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="logModalLabel">Login</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <input id="username_in" class="form-control mt-2" type="text"
                                           placeholder="Username">
                                    <input id="password_in" class="form-control mt-2" type="password"
                                           placeholder="Password">
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-primary"
                                            onclick="login()">Login
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container-fluid" id="app-main">
    <div class="d-flex content">
        <div class="d-flex flex-column">
            <div class="flex-column">
                <h2 class="PageDescription" style="text-align: center">You are tired of forgetting your Dnd character sheet
                    all the time?
                    Your sheet always looks totally scribbled after a session? Then this is the right place for you!</h2>
            </div>

            <div class="flex-column PageDescriptionLong">
                <p class="Text flex-column" style="text-align: center"> This website provides you the ability to create, edit
                    and store your character sheet online, so you will never struggle from an overcrowded or lost
                    charactersheet again.
                    Of course you can also modify your character stats once your character levels up or takes damage.
                <p class="Text flex-column"  style="text-align: center"> As the dungeon master of your player group you can
                    also create and manage your group online, so playing as a group becomes even more fun! Your fellow
                    player can even send you messages,
                    which can make your game more immersive while still maintaining the little secrets you prepared for
                    the group members.</p>
                <p class="Text flex-column"  style="text-align: center"> "Alexa, change the hitpoints!" Using the popular voice
                    assistant Alex you can make changes to your character sheet during a game without the need for
                    manual input.
                    With the support of our website your next campaign will be a Nat20! </p>
            </div>

            <div class=" flex-column m-0 justify-content-center ">
                <div class="d-flex justify-content-center m-2">
                    <img style=" width: 65%" src="../../Images/SCL_Keyart_Thumb.jpg" >
                </div>
            </div>

            <div class="m-0 flex-column">
                <h3 class="container-fluid" id="lining"> What is DnD? </h3>

                <p class="Text" >Dungeons and Dragons is a pen and paper role playing game published in
                    1974 by Gary Gygax and Dave Arneson.
                    It is about adventures that take place in fictional worlds. The Dungeon Master creates
                    different scenarios, which the players have to master with their fictitious characters.
                    Dungeons and Dragons has become immensely popular over the years, and D&D has grown to
                    include many new ways to vividly experience worlds of heroic fantasy.
                    Storytelling in DnD allows you and your friends to experience and change the story together.
                    You lead your heroes through quest for treasure, battles with deadly enemies, daring rescue
                    missions, courtly intrigues and much more.</p>

            </div>






            <div class="flex-column m-0">
                <img style="width: 100%" src="../../Images/NEW-TO-DnD_What-is-DnD_Subsection_Hero_140718.jpg">
            </div>
        </div>
    </div>



</div>

<script>
    // When the user scrolls the page, execute myFunction
    window.onscroll = function () {
        scrollFunction()
    };

    // Get the header
    let header = document.getElementById("OptionsHeader");

    // Get the offset position of the navbar
    let sticky = header.offsetTop;

    // Add the sticky class to the header when you reach its scroll position. Remove "sticky" when you leave the scroll position
    function scrollFunction() {
        if (window.pageYOffset > sticky) {
            header.classList.add("sticky");
        } else {
            header.classList.remove("sticky");
        }
    }

</script>

<script type="application/javascript">

    function checkExistingUsername(name) {

        const result =  fetch('https://characterforge.azurewebsites.net/api/v1.0/User/usercheck/' + name, {
            method: 'get',
        })
            .then(function (response) {
                if(response.status !== 200) throw("error!");

                return response.json();

            })
            .then(function (data){
                return data.exists;
            })
            .catch(function (error) {
                alert(error);
            });
    }

    async function register() {
        const username = document.getElementById("username").value;
        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;
        const password_conf = document.getElementById("password_conf").value;

        if (password !== password_conf) {
            alert("Passwords do not match")
            return;
        }
        if (password.length < 8 || password.replace(/\s/g,"") == "") {
            alert("Password is not long enough! Minimum of 8 characters!");
            return;
        }
        if (username.replace(/\s/g,"") == "" || !username || username.length<3) {
            alert("Your charactername is either empty or is too short!");
            return;
        }
        if (email.replace(/\s/g,"") == "" || !email || email.length<3) {
            alert("Your email address is either empty or is too short!");
            return;
        }
        if (await checkExistingUsername(username)) {
            alert("Username already taken!");
            return;
        }

        fetch('https://characterforge.azurewebsites.net/api/v1.0/User/register', {
            method: 'post',
            headers: {
                'Content-Type': 'application/json', 'Accept': '*/*'
            },
            body: JSON.stringify({
                "name": username,
                "email": email,
                "password": password
            })
        })
            .then(function (response) {
                if (response.status !== 200) throw response.status;

                return response.json();
            })
            .then(result => {
                console.log('Success:', result);
                if (typeof (Storage) !== "undefined" && result.userID != null) {
                    localStorage.setItem("userID", result.userID);
                    localStorage.setItem("userName", result.name);
                    window.location.assign("https://onlineverwaltungdnd.azurewebsites.net/Dashboard/");
                }
            })
            .catch(function (error) {
                 alert(error)
            });
    }

    function login() {
        const username = document.getElementById("username_in").value;
        const password = document.getElementById("password_in").value;



        fetch('https://characterforge.azurewebsites.net/api/v1.0/User/login', {
            method: 'post',
            headers: {
                'Content-Type': 'application/json', 'Accept': '*/*'
            },
            body: JSON.stringify({
                "username": username,
                "password": password
            })
        })
            .then(function (response) {
                if (response.status !== 200) throw response.status;

                    return response.json();
            })
            .then(result => {
                console.log('Success:', result);
                if (typeof (Storage) !== "undefined" && result.userID != null) {
                    localStorage.setItem("userID", result.userID);
                    localStorage.setItem("userName", result.name);
                    window.location.assign("https://onlineverwaltungdnd.azurewebsites.net/Dashboard/");
                }
            })
            .catch(function (error) {
                alert("No user found!");
            });
    }

</script>

</body>
</html>